# 개발 관련 가이드

> 개발 시 참고할 수 있는 주요 사항들을 정리해 놓은 문서입니다.

---
### 한국은행 데이터분석 라이브러리 개발 표준


| 항목              | 규칙                                                                                                                                                                      |
|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| ① 모듈명          | 모듈 이름은 짧으면서 해당 기능을 사용자에게 명확하게 전달할 수 있어야 하며, 영어 소문자만 사용                                                                                             |
|                   | 예시) 상태공간모형 중 은닉인자모형(Unobserved Component model)을 추정하는 함수와 클래스가 있는 모듈은 `uc.py`로 설정                                                          |
| ② 변수·함수명     | Snake case(소문자만 사용하며 단어와 단어 사이는 `_`로 구분)를 적용하고, 함수 이름으로 어떤 작업을 수행하는 함수인지 명확히 하지 않을 경우에는 동사를 사용                                                |
|                   | 예시) BIDS API를 호출해서 데이터를 입수하는 함수명은 `get_bidas_data`로 설정                                                                                               |
| ③ 클래스명        | Pascal case(단어 사이 구분 없이 단어 첫 글자에 대문자 사용)를 적용                                                                                                        |
|                   | 예시) VAR 모형 인스턴스를 생성하는 클래스명을 `VectorAutoRegression`으로 설정                                                                                              |
| ④ 데이터 자료형   | 함수의 인자로 들어가는 데이터는 데이터 고유의 행과 열 정보(날짜 정보와 변숫명 정보 등)를 잃지 않도록 `pandas.DataFrame` 자료형 사용을 표준으로 함                                                   |
| ⑤ 함수 인자 순서  | 모형을 결정하는 필수 인자(회귀식, 데이터 등), 옵션 인자(옵션 인자는 자주 사용되는 순서로 배치), 특수 인자(특정 함수에서만 사용되는 인자) 순서로 배치                                                  |
| ⑥ 하이퍼 파라미터 | 기본값을 설정해서 사용자가 인자 구조를 정확하게 몰라도 함수를 사용할 수 있게 문제되지 않도록 하며, 자료형에 대한 타이핑을 함                                                       |
|                   | 예시) `def var(y: pd.DataFrame, lag: int=1, h: int=None)`                                                                                                                  |
| ⑦ 문서화(docstring) | 주요 함수·클래스는 PEP 257에 근거해 설명과 사용 예제를 문서화                                                                                                               |
| ⑧ 함수 결과       | 주요 입력 작업의 결과는 클래스 인스턴스로 구조화해 메서드를 이용해 분석과 결과를 그리거나 테이블이 출력되도록 하는 반면, 간단한 결과 반환에는 데이터클래스(`dataclass`)를 사용                                               |

> 주 1) 모듈은 특정 기능을 수행하는 함수와 클래스 코드를 모아놓는 하나의 소스 코드 파일 확장자(.py)로 의미  
> 주 2) PEP 257은 코드의 가독성과 유지보수성을 높이기 위해 docstring 작성 규칙과 스타일 가이드를 정의한 문서



---
### 개발환경 세팅 방법 (Apple Silicon Mac 기준)

1. 파이썬 3.11, pip 설치 (이미 설치되었을 시 패스)
```sh
brew install python@3.11
```

2. 개발환경 세팅 (가상환경 세팅)
```sh
# requriements.txt 파일이 있는 디렉토리에서 실행하세요
python3.11 -m pip install virtualenv
python3.11 -m virtualenv venv
source venv/bin/activate  # 가상환경 활성화
pip --version  # python 3.11인치 확인해주세요
pip install -r requirements.txt # 가상환경 내에 패키지 설치
deactivate # 가상환경 비활성화
```

3. 가상환경 사용방법
```sh
source venv/bin/activate  # 가상환경 활성화

# 이후 원하는 디렉토리로 이동하여 코드 실행
# eg.
cd demo
python python demo_logistic_reg_freq.py 
```

---
### 테스트, 데모 실행 관련

- `_test.py` 파일과 `_test`로 시작하는 `.py`, `.ipynb` 파일의 경우 git을 통해 변경사항이 추적되지 않습니다.
- `_test`로 시작하는 폴더도 마찬가지로 변경사항이 추적되지 않습니다.
- 따라서 작업 중 git으로 변경사항 추적을 원하지 않는 간단한 테스트 파일의 경우에는, `_test`로 시작되게끔 파일명을 설정해서 사용하거나 `_test`폴더에서 작업하시면 됩니다.

```
# cf. gitignore 파일 내의 내용
_test.py
_test*.py
_test.ipynb
_test*.ipynb
_test/*
_test
```

- `demo` 폴더 안의 코드는 실제 데이터를 사용해 모델을 적합하고 결과를 출력해보는 코드입니다.
- 


---
### 개별 모델의 Class 구조 및 코드 규칙

##### 코드 작성 시의 규칙

- 함수 및 클래스의 Docstring은 numpy style을 사용합니다. (numpy style은 pep257의 기본 원칙을 준수하며, 데이터과학 및 수학 라이브러리에서 자주 쓰이는 방식입니다)
- 클래스 메소드와 독스트링의 예시는 `bok_data_lib/freq/logistic_reg_freq.py`를 참고해주세요.


#### Class의 기본 구조

- 모델의 하이퍼파라미터, 세팅값은 클래스를 initialize할 때 전달합니다.
- 객체의 `.fit()` 메소드를 call 하여 fit을 실행합니다. 여러가지의 적합 방식이 존재하므로, 개별 적합 방식은 internal method로 구현하고, fit에서는 해당하는 method를 call해서 사용합니다.   
    eg. `fit()`에서 실행 시 `self.method == 'newton'`이면 `_fit_newton()`을 call 하여 사용하는 식


